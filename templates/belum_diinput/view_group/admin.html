{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% load l10n %}

{% block belum_diinput %}

    <div class="antialiased bg-gray-800  ">
        {% include 'components/header.html' %}

        <div class="p-4 pt-20">
            <div class="flex text-white text-2xl justify-between">
                <div>DATA BELUM SELESAI DIINPUT</div>

            </div>
            <div class="mt-3" id="table_belum_diinput"></div>
            <div class="mx-auto">

                <script>
                    document.addEventListener("DOMContentLoaded", function () {
                        function formatRupiah(amount) {
                            try {
                                const num = parseFloat(amount) || 0;
                                return num.toLocaleString('id-ID'); // Otomatis jadi 1.000.000
                            } catch (e) {
                                return "0";
                            }
                        }

                        function formatDate(idDate) {
                            if (!idDate) return "";

                            const date = new Date(idDate);
                            if (isNaN(date)) return idDate;

                            const options = { day: 'numeric', month: 'long', year: 'numeric' };
                            return new Intl.DateTimeFormat('id-ID', options).format(date);
                        }

                        function formatTime(timeStr) {
                            if (!timeStr) return "";

                            if (typeof timeStr === "string") {
                                const parts = timeStr.split(":");
                                return `${parts[0]}:${parts[1]}`;
                            }

                            if (timeStr instanceof Date) {
                                const hours = timeStr.getHours().toString().padStart(2, '0');
                                const minutes = timeStr.getMinutes().toString().padStart(2, '0');
                                return `${hours}:${minutes}`;
                            }

                            return timeStr;
                        }

                        var table = new Tabulator("#table_belum_diinput", {
                            layout: "fitColumns",
                            responsiveLayout: "collapse",
                            ajaxURL: "{% url 'belum_diinput_api' %}",
                            placeholder: "Data tidak tersedia",
                            ajaxConfig: "GET",
                            pagination: true,
                            paginationMode: "remote",
                            paginationSize: 10,
                            paginationCounter: "rows",

                            columns: [
                                {
                                    title: "NO",
                                    field: "no",
                                    hozAlign: "center",
                                    headerHozAlign: "center",
                                    formatter: function (cell) {
                                        let page = cell.getTable().getPage();
                                        let pageSize = cell.getTable().getPageSize();
                                        return (page - 1) * pageSize + cell.getRow().getPosition(true);
                                    },

                                },
                                {
                                    title: "Tanggal",
                                    field: "tanggal",
                                    headerHozAlign: "center",
                                    hozAlign: "center",
                                    formatter: function (cell) {
                                        return formatDate(cell.getValue());
                                    },
                                },
                                {
                                    title: "Jam Rapat",
                                    field: "jam",
                                    headerHozAlign: "center",
                                    hozAlign: "center",
                                    formatter: function (cell) {
                                        return formatTime(cell.getValue());
                                    },
                                },
                                { title: "Nama", field: "nama", headerHozAlign: "center", headerFilter:"input" },
                                { title: "Surat", field: "judul_surat", headerHozAlign: "center" , headerFilter:"input" },

                                { title: "Kontrak", field: "judul_kontrak", headerHozAlign: "center" , headerFilter:"input" },
                                {
                                    title: "Masuk",
                                    field: "kas_masuk",
                                    headerHozAlign: "center",
                                    hozAlign: "right",
                                    formatter: function (cell) {
                                        return formatRupiah(cell.getValue());
                                    }
                                },
                                {
                                    title: "Keluar",
                                    field: "kas_keluar",
                                    headerHozAlign: "center",
                                    hozAlign: "right",
                                    formatter: function (cell) {
                                        return formatRupiah(cell.getValue());
                                    }
                                },
                                {
                                    title: "AKSI",
                                    field: "actions",
                                    hozAlign: "center",
                                    headerHozAlign: "center",
                                    formatter: function (cell) {
                                        const rowData = cell.getRow().getData();
                                        return `
                                                <div class="flex space-x-2 justify-center gap-2">
                                            
                                                    <button 
                                                        data-modal-target="edit_nominal_belum_input${rowData.id}" 
                                                        data-modal-toggle="edit_nominal_belum_input${rowData.id}" 
                                                        class="edit_nominal_belum_input bg-yellow-600 hover:bg-yellow-800 text-white font-bold py-1 px-2 rounded focus:ring-4 focus:ring-yellow-300" 
                                                        title="Edit Nominal">
                                                        <svg class="w-4 h-4 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                                                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 17.345a4.76 4.76 0 0 0 2.558 1.618c2.274.589 4.512-.446 4.999-2.31.487-1.866-1.273-3.9-3.546-4.49-2.273-.59-4.034-2.623-3.547-4.488.486-1.865 2.724-2.899 4.998-2.31.982.236 1.87.793 2.538 1.592m-3.879 12.171V21m0-18v2.2"/>
                                                        </svg>
                                                    </button>
                                                </div>
                                            `;
                                    },
                                    cellClick: function(e, cell) {
                                        const rowData = cell.getRow().getData();
                                        const btn = e.target.closest("button");

                                        if (!btn) return;

                                        const isEditNominal = btn.classList.contains("edit_nominal_belum_input");



                                        if (isEditNominal) {
                                            const modal = document.getElementById(`edit_nominal_belum_input${rowData.id}`);
                                            if (modal) new Modal(modal).show();
                                        }
                                    }
                                }
                            ]
                        });
                    });
                </script>

            </div>

        </div>


        {% include 'belum_diinput/modal/edit_data_rapat.html' %}
        {% include 'belum_diinput/modal/edit_nominal.html' %}

        {% include 'copyright.html' %}



{% endblock %}
