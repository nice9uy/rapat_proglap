<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Inisialisasi semua modal
    const modalElements = document.querySelectorAll('[id^="user_edit"], [id^="delete_user"], #tambah_user');
    window.modals = {};

    modalElements.forEach(el => {
      const id = el.getAttribute('id');
      if (!window.modals[id]) {
        window.modals[id] = new Modal(el);
      }
    });

    // Handle klik tombol buka modal
    document.body.addEventListener("click", function (e) {
      const btn = e.target.closest('[data-modal-toggle]');
      if (btn) {
        e.preventDefault();
        const targetId = btn.getAttribute('data-modal-toggle');
        const modal = window.modals[targetId];
        if (modal) {
          modal.show(); // Buka modal lewat JS
        }
      }
    });

    // Handle klik tombol tutup (termasuk X dan backdrop)
    document.body.addEventListener("click", function (e) {
      const closeBtn = e.target.closest('[data-modal-hide]');
      if (closeBtn) {
        e.preventDefault();
        const targetId = closeBtn.getAttribute('data-modal-hide');
        const modal = window.modals[targetId];
        if (modal) {
          modal.hide(); // Tutup lewat JS â†’ Flowbite akan hapus backdrop
        }
      }
    });

    // Opsional: klik backdrop juga tutup modal
    document.body.addEventListener("click", function (e) {
      if (e.target.classList.contains('modal-backdrop')) {
        // Cari modal yang aktif
        const modal = document.querySelector('.modal[style*="display: block"]');
        const modalId = modal ? modal.getAttribute('id') : null;
        if (modalId && window.modals[modalId]) {
          window.modals[modalId].hide();
        }
      }
    });

    // Handle form submit: setelah submit, tutup modal & hapus backdrop
    document.getElementById('tambah_user').addEventListener('submit', function () {
      const modal = window.modals['tambah_user'];
      if (modal) {
        modal.hide(); // Pastikan modal ditutup secara manual
      }
    });

    // Inisialisasi Tabulator (seperti sebelumnya)
    var table = new Tabulator("#table_tambah_user", {
      // ... konfigurasi kamu
    });
  });
</script>